<!--
  Veltrax — Real-Time Approval Lift (Same Portfolio Loss)
  Single-file GitHub Page · No deps · Responsive
  What it shows: extra approved loans/cards at the same portfolio loss after unified scoring.
  Inputs: apps/day, approval rate, avg margin per approval, current loss rate, AUC uplift, baseline AUC, one-time cost.
  Outputs: incremental approvals/day, incremental margin/day, approval lift (same loss), days to payback. ROC-style curve + operating points.
  Method: equal-variance binormal model. Convert AUC -> d' (AUC = Φ(d'/√2)).
          Calibrate baseline threshold so approval rate & loss rate match inputs.
          With uplifted AUC, find new threshold giving the same loss rate. Compute new approvals.
-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Veltrax — Real-Time Approval Lift</title>
    <style>
      :root{
        --vx-primary:#4c8dff; --vx-bg:#131417; --vx-surface:#1b1d23; --vx-surface-2:#20232b;
        --vx-border:#2c2f36; --vx-text:#e6e7eb; --vx-muted:#9aa1b3; --vx-good:#4cff88; --vx-danger:#ff453a; --vx-ring:rgba(76,141,255,.45);
      }
      *,*::before,*::after{box-sizing:border-box}
      html,body{height:100%}
      body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;color:var(--vx-text);background:radial-gradient(1000px 420px at 50% -200px, rgba(111,66,193,.25), transparent 60%), var(--vx-bg)}
      .container{max-width:1280px;margin:0 auto;padding:0 24px}
      .hero{padding:36px 0 12px}
      .hero h1{margin:8px 0 6px;font-size:40px;line-height:1.15}
      .muted{color:var(--vx-muted)}
      .card{background:linear-gradient(180deg,var(--vx-surface),var(--vx-surface-2));border:1px solid var(--vx-border);border-radius:16px;padding:20px;box-shadow:0 1px 0 rgba(0,0,0,.25)}
      .row{display:grid;gap:16px}
      @media (min-width:960px){.row.cols-2{grid-template-columns:1.1fr .9fr}}
      .grid{display:grid;gap:14px}
      @media (min-width:760px){.grid.kpis{grid-template-columns:repeat(4,1fr)}}
      label{font-size:14px;font-weight:600;display:block}
      label small{display:block;color:var(--vx-muted);font-weight:400;margin-top:4px}
      input[type=range]{width:100%}
      input[type=number]{width:160px;background:#151821;border:1px solid var(--vx-border);border-radius:10px;color:var(--vx-text);padding:10px;font-size:15px}
      .row-2{display:grid;gap:14px}
      @media (min-width:680px){.row-2{grid-template-columns:1fr 1fr}}
      .kpi{background:#16181f;border:1px solid var(--vx-border);border-radius:12px;padding:14px}
      .kpi .label{font-size:12px;color:var(--vx-muted)}
      .kpi .value{font-size:24px;font-weight:700;margin-top:6px;font-family:ui-monospace,Menlo,Consolas,monospace}
      .chart{height:420px;border:1px solid var(--vx-border);border-radius:14px;position:relative;background:#0f1219;margin-top:12px}
      .legend{display:flex;gap:12px;position:absolute;bottom:12px;left:12px;font-size:12px;color:var(--vx-muted);flex-wrap:wrap}
      .dot{display:inline-block;width:12px;height:12px;border-radius:50%}
      .c1{background:var(--vx-primary)} .c2{background:var(--vx-good)} .c3{background:#7f8696}
      footer{border-top:1px solid var(--vx-border);margin-top:36px;padding:24px 0 56px}
      .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
      .pill{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--vx-border);padding:8px 12px;border-radius:999px;background:#181a21;font-size:14px}
      .help{font-size:12px;color:var(--vx-muted)}
    </style>
  </head>
  <body>
    <header class="container hero">
      <div style="display:flex;align-items:center;gap:10px">
        <svg width="22" height="22" viewBox="0 0 64 64" aria-hidden="true"><rect x="6" y="10" width="52" height="12" rx="6" fill="#fff"/><rect x="6" y="30" width="42" height="12" rx="6" fill="#fff"/><rect x="6" y="50" width="26" height="8" rx="4" fill="#6F42C1"/></svg>
        <span class="muted" style="letter-spacing:.2em;font-size:11px">VELTRAX</span>
      </div>
      <h1>Real‑Time Approval Lift — Same Portfolio Loss</h1>
      <p class="muted" style="max-width:860px">Unified, local scoring approves more good customers without increasing portfolio loss. Adjust the assumptions and see the lift.</p>
    </header>

    <main class="container row cols-2">
      <section class="card">
        <h2 style="margin:0 0 8px;font-size:18px">Assumptions</h2>
        <div class="row-2">
          <div>
            <label class="mono">Applications per day (<span id="out-apps">200,000</span>)<small>Total inbound apps/cards</small></label>
            <input id="in-apps" type="range" min="10000" max="500000" step="1000" value="200000"/>
          </div>
          <div>
            <label class="mono">Approval rate (<span id="out-appr">40%</span>)<small>Current approvals as a share of apps</small></label>
            <input id="in-appr" type="range" min="10" max="90" step="1" value="40"/>
          </div>
          <div>
            <label class="mono">Avg margin per approved ($)<small>Net present value per good approval</small></label>
            <input id="in-margin" type="number" value="120" min="0" step="10"/>
          </div>
          <div>
            <label class="mono">Current loss rate (<span id="out-loss">5.0%</span>)<small>Defaults/charge‑offs among approved</small></label>
            <input id="in-loss" type="range" min="0.5" max="20" step="0.1" value="5"/>
          </div>
          <div>
            <label class="mono">AUC uplift (<span id="out-uplift">0.060</span>)<small>Unified scoring improvement</small></label>
            <input id="in-uplift" type="range" min="0" max="0.10" step="0.005" value="0.06"/>
          </div>
          <div>
            <label class="mono">One‑time implementation cost ($)<small>Used for payback period</small></label>
            <input id="in-onetime" type="number" value="180000" min="0" step="1000"/>
          </div>
        </div>
        <div class="card" style="margin-top:12px">
          <label class="mono">Advanced: baseline AUC ( <span id="out-auc">0.70</span> )<small>We infer the baseline threshold and applicant bad‑rate from your approval and loss rates.</small></label>
          <input id="in-auc" type="range" min="0.55" max="0.90" step="0.005" value="0.70"/>
        </div>
      </section>

      <aside class="card">
        <h2 style="margin:0 0 8px;font-size:18px">Results</h2>
        <div class="grid kpis" aria-live="polite">
          <div class="kpi"><div class="label">Incremental approvals / day</div><div id="k-apps" class="value">—</div></div>
          <div class="kpi"><div class="label">Incremental margin / day</div><div id="k-margin" class="value">—</div></div>
          <div class="kpi"><div class="label">Approval lift (same loss)</div><div id="k-lift" class="value">—</div></div>
          <div class="kpi"><div class="label">Days to payback</div><div id="k-payback" class="value">—</div></div>
        </div>
        <div class="help" id="k-operating" style="margin-top:10px"></div>
      </aside>
    </main>

    <section class="container card" style="margin-top:18px">
      <h3 style="margin:0 0 8px;font-size:16px">ROC — discrimination improves, approvals rise (loss held constant)</h3>
      <div class="chart">
        <svg id="roc" role="img" aria-label="ROC curves and operating points"></svg>
        <div class="legend"><span><i class="dot c1"></i> Baseline AUC</span><span><i class="dot c2"></i> Unified (AUC+uplift)</span><span><i class="dot c3"></i> 45° reference</span></div>
      </div>
    </section>

    <footer>
      <div class="container" style="display:flex;justify-content:space-between;gap:16px;flex-wrap:wrap">
        <div style="display:flex;align-items:center;gap:10px">
          <svg width="22" height="22" viewBox="0 0 64 64" aria-hidden="true"><rect x="6" y="10" width="52" height="12" rx="6" fill="#fff"/><rect x="6" y="30" width="42" height="12" rx="6" fill="#fff"/><rect x="6" y="50" width="26" height="8" rx="4" fill="#6F42C1"/></svg>
          <span class="muted" style="letter-spacing:.2em;font-size:11px">VELTRAX</span>
        </div>
        <div class="muted">Local‑first. Private by default. Built for operators who need provable ROI.</div>
      </div>
    </footer>

    <script>
      const $ = s => document.querySelector(s);
      const fmt = n => n.toLocaleString();
      const money = n => n.toLocaleString(undefined,{style:'currency',currency:'USD',maximumFractionDigits:0});

      // —— Math helpers: Φ, Φ^{-1} (Acklam), N(μ,σ) tail ——
      function normCdf(x){ return 0.5*(1+erf(x/Math.SQRT2)); }
      function erf(x){ // Abramowitz-Stegun approximation
        const a1=0.254829592,a2=-0.284496736,a3=1.421413741,a4=-1.453152027,a5=1.061405429,p=0.3275911;
        const sign = x<0?-1:1; x=Math.abs(x);
        const t=1/(1+p*x); const y=1-((((a5*t+a4)*t+a3)*t+a2)*t+a1)*t*Math.exp(-x*x);
        return sign*y;
      }
      function normInv(p){ // Acklam's inverse CDF
        if(p<=0||p>=1) return NaN;
        const a=[-3.969683028665376e+01,2.209460984245205e+02,-2.759285104469687e+02,1.383577518672690e+02,-3.066479806614716e+01,2.506628277459239e+00];
        const b=[-5.447609879822406e+01,1.615858368580409e+02,-1.556989798598866e+02,6.680131188771972e+01,-1.328068155288572e+01];
        const c=[-7.784894002430293e-03,-3.223964580411365e-01,-2.400758277161838e+00,-2.549732539343734e+00,4.374664141464968e+00,2.938163982698783e+00];
        const d=[7.784695709041462e-03,3.224671290700398e-01,2.445134137142996e+00,3.754408661907416e+00];
        let q, r;
        if (p < 0.02425){ q=Math.sqrt(-2*Math.log(p)); return (((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5]) / ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1); }
        else if (p > 1-0.02425){ q=Math.sqrt(-2*Math.log(1-p)); return -(((((c[0]*q+c[1])*q+c[2])*q+c[3])*q+c[4])*q+c[5]) / ((((d[0]*q+d[1])*q+d[2])*q+d[3])*q+1)); }
        q=p-0.5; r=q*q; return (((((a[0]*r+a[1])*r+a[2])*r+a[3])*r+a[4])*r+a[5])*q / (((((b[0]*r+b[1])*r+b[2])*r+b[3])*r+b[4])*r+1);
      }
      const phi = normCdf; const PHIinv = normInv;

      // From AUC to d' (equal-variance binormal): AUC = Φ(d'/√2) => d' = √2 Φ^{-1}(AUC)
      const aucToD = auc => Math.SQRT2 * PHIinv(Math.min(Math.max(auc, 1e-6), 1-1e-6));

      // Tail prob for N(μ,1): P(X >= t)
      const tail = (t, mu=0) => 1 - phi((t-mu));

      // Calibrate baseline: find threshold τ and base bad-rate B so that
      // a0 = approvals = (1-B)·Pg + B·Pb   and   l0 = (B·Pb)/a0
      function calibrateBaseline(auc, apprRate, lossRate){
        const d = aucToD(auc); const mu_g = d/2, mu_b = -d/2;
        const a0 = apprRate, L0 = lossRate;
        let lo=-5, hi=5, it=0; let tau=0, B=0;
        while(it++<80){
          tau = (lo+hi)/2;
          const Pg = tail(tau, mu_g); const Pb = tail(tau, mu_b);
          const Bhat = (L0*a0)/(Pb+1e-12); // implied base bad-rate in population
          const a_hat = (1-Bhat)*Pg + Bhat*Pb;
          if (a_hat > a0) lo = tau; else hi = tau; // move threshold to match approval rate
        }
        const Pg = tail(tau, mu_g); const Pb = tail(tau, mu_b);
        B = (L0*a0)/(Pb+1e-12);
        return { d, mu_g, mu_b, tau, B: Math.min(Math.max(B,1e-6), 0.5) }; // cap for sanity
      }

      // Given auc (-> d) and B, find tau producing specified approved bad-rate L (portfolio loss)
      function findTauForLoss(auc, B, L){
        const d = aucToD(auc); const mu_g = d/2, mu_b = -d/2;
        let lo=-5, hi=5, tau=0; let it=0;
        while(it++<80){
          tau = (lo+hi)/2;
          const Pg = tail(tau, mu_g); const Pb = tail(tau, mu_b);
          const a = (1-B)*Pg + B*Pb; const Lhat = (B*Pb)/(a+1e-12);
          if (Lhat > L) lo = tau; else hi = tau; // lower L needs lower tau (stricter), so binary search
        }
        const Pg = tail(tau, mu_g); const Pb = tail(tau, mu_b);
        const a = (1-B)*Pg + B*Pb;
        return { tau, a, TPR:Pg, FPR:Pb };
      }

      // ROC curve points for visualization
      function rocPoints(auc, n=80){
        const d = aucToD(auc); const mu_g = d/2, mu_b = -d/2; const pts=[];
        for(let i=0;i<=n;i++){
          const t = -4 + 8*(i/n); // threshold
          const Pg = tail(t, mu_g); const Pb = tail(t, mu_b);
          pts.push({fpr:Pb, tpr:Pg});
        }
        return pts;
      }

      function update(){
        const apps = +$('#in-apps').value;
        const appr = +$('#in-appr').value/100; $('#out-appr').textContent = Math.round(appr*100)+'%';
        const margin = +$('#in-margin').value;
        const loss = +$('#in-loss').value/100; $('#out-loss').textContent = (+$('#in-loss').value).toFixed(1)+'%';
        const uplift = +$('#in-uplift').value; $('#out-uplift').textContent = uplift.toFixed(3);
        const onetime = +$('#in-onetime').value;
        const auc0 = +$('#in-auc').value; $('#out-auc').textContent = auc0.toFixed(2);
        const auc1 = Math.min(0.995, auc0+uplift);

        // Calibrate baseline threshold & base-rate
        const base = calibrateBaseline(auc0, appr, loss);
        const basePg = tail(base.tau, base.mu_g); const basePb = tail(base.tau, base.mu_b);
        const appr0 = (1-base.B)*basePg + base.B*basePb; // should ~ appr

        // Improved model: same B, same loss, find new tau
        const uni = findTauForLoss(auc1, base.B, loss);
        const appr1 = uni.a;

        const lift = (appr1/appr0 - 1);
        const incApprovals = Math.max(0, Math.round(apps*(appr1-appr0)));
        const incMargin = incApprovals * margin;
        const payback = incMargin>0 ? Math.ceil(onetime / incMargin) : Infinity;

        $('#out-apps').textContent = fmt(apps);
        $('#k-apps').textContent = incApprovals>0 ? fmt(incApprovals) : '—';
        $('#k-margin').textContent = incMargin>0 ? money(incMargin) : '—';
        $('#k-lift').textContent = (lift>0 ? (lift*100).toFixed(1)+'%' : '—');
        $('#k-payback').textContent = (payback===Infinity? '—' : `${payback} days`);
        $('#k-operating').textContent = `Baseline operating point: FPR ${(basePb*100).toFixed(1)}%, TPR ${(basePg*100).toFixed(1)}% · Unified operating point: FPR ${(uni.FPR*100).toFixed(1)}%, TPR ${(uni.TPR*100).toFixed(1)}%`;

        drawROC(auc0, auc1, {base:{fpr:basePb,tpr:basePg}, uni:{fpr:uni.FPR,tpr:uni.TPR}});
      }

      // Draw ROC curves + operating points
      function drawROC(auc0, auc1, ops){
        const svg = $('#roc'); while(svg.firstChild) svg.removeChild(svg.firstChild);
        const parent = svg.parentElement; const W = Math.max(560, parent.clientWidth); const H = 380; const P=48;
        svg.setAttribute('viewBox',`0 0 ${W} ${H}`);
        const NS='http://www.w3.org/2000/svg';
        const x = fpr => P + (W-2*P)*fpr; const y = tpr => H-P - (H-2*P)*tpr;

        function pathFrom(pts, color){
          const d = pts.map((p,i)=>`${i?'L':'M'} ${x(p.fpr)} ${y(p.tpr)}`).join(' ');
          const el = document.createElementNS(NS,'path'); el.setAttribute('d',d); el.setAttribute('fill','none'); el.setAttribute('stroke',color); el.setAttribute('stroke-width','2.5'); el.setAttribute('vector-effect','non-scaling-stroke'); svg.appendChild(el);
        }
        function point(p, color){
          const c = document.createElementNS(NS,'circle'); c.setAttribute('cx',x(p.fpr)); c.setAttribute('cy',y(p.tpr)); c.setAttribute('r',5); c.setAttribute('fill',color); c.setAttribute('stroke','#000'); c.setAttribute('stroke-width','1'); svg.appendChild(c);
        }
        function label(p, text){
          const t = document.createElementNS(NS,'text'); t.setAttribute('x', x(p.fpr)+8); t.setAttribute('y', y(p.tpr)-8); t.setAttribute('fill', '#cfd2da'); t.setAttribute('font-size','12'); t.textContent = text; svg.appendChild(t);
        }
        function axis(){
          const a = document.createElementNS(NS,'path'); a.setAttribute('d',`M ${P} ${H-P} L ${W-P} ${H-P} M ${P} ${H-P} L ${P} ${P}`); a.setAttribute('stroke','#39404e'); a.setAttribute('stroke-width','1'); svg.appendChild(a);
          const ref = document.createElementNS(NS,'path'); ref.setAttribute('d',`M ${P} ${H-P} L ${W-P} ${P}`); ref.setAttribute('stroke','#6c7385'); ref.setAttribute('stroke-dasharray','6 6'); ref.setAttribute('stroke-width','1.2'); svg.appendChild(ref);
          const tx = document.createElementNS(NS,'text'); tx.setAttribute('x',W/2); tx.setAttribute('y',H-12); tx.setAttribute('fill','#9aa1b3'); tx.setAttribute('text-anchor','middle'); tx.setAttribute('font-size','12'); tx.textContent='False Positive Rate'; svg.appendChild(tx);
          const ty = document.createElementNS(NS,'text'); ty.setAttribute('x',16); ty.setAttribute('y',H/2); ty.setAttribute('fill','#9aa1b3'); ty.setAttribute('font-size','12'); ty.setAttribute('transform',`rotate(-90 16 ${H/2})`); ty.textContent='True Positive Rate'; svg.appendChild(ty);
        }
        axis();
        pathFrom(rocPoints(auc0), 'var(--vx-primary)');
        pathFrom(rocPoints(auc1), 'var(--vx-good)');
        point(ops.base, 'var(--vx-primary)'); label(ops.base,'Baseline');
        point(ops.uni, 'var(--vx-good)'); label(ops.uni,'Unified');
      }

      // Bind inputs
      ['in-apps','in-appr','in-margin','in-loss','in-uplift','in-onetime','in-auc'].forEach(id=>{
        document.getElementById(id).addEventListener('input', update);
      });

      // First render
      update();
      // Handle resize for SVG
      window.addEventListener('resize', ()=> drawROC(+$('#in-auc').value, Math.min(0.995, +$('#in-auc').value + +$('#in-uplift').value), {base:{fpr:0,tpr:0}, uni:{fpr:0,tpr:0}}));
    </script>
  </body>
</html>
